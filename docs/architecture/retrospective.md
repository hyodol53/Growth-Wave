# 'AI 기반 나의 성장 회고록' (FR-B-1) 설계 명세서

## 1. 설계 목표
[발표] 자료의 "내가 지난 6개월간 뭘 했지?"라는 사용자의 막막함을 해결하기 위해, Jira 및 Bitbucket 활동을 기반으로 AI(LLM)가 회고록 초안을 생성하는 `FR-B-1` 기능의 상세 설계를 정의한다.

본 설계는 `FR-B-1.3` (프라이버시 보장)을 최우선 원칙으로 하며, 수집된 데이터 및 생성된 회고록이 **오직 사용자 본인에게만** 접근 가능하도록 보장하는 것을 목표로 한다.

---

## 2. 핵심 설계 원칙

### 1. 프라이버시 최우선 (Privacy First)
* **[FR-B-1.3]** 생성된 회고록은 **오직 사용자 본인만** 조회, 수정, 삭제할 수 있다.
* **[FR-B-1.3]** 이 데이터는 관리자용 'Growth & Culture 리포트'(`FR-A-4.6`)에 **절대 포함되지 않는다.**
* **[NFR-2]** 관리자를 포함한 타인은 이 데이터에 절대 접근할 수 없어야 한다.

### 2. On-Demand 데이터 처리 (실시간 요청)
* 사용자의 Jira/Bitbucket 활동 로그(커밋, 댓글 등)는 `Growth-Wave` 시스템 데이터베이스에 **미리 수집 및 저장되지 않는다.**
* 데이터는 사용자가 '회고록 생성'을 요청하는 시점에, 사용자의 인증 토큰을 기반으로 각 시스템(Jira/Bitbucket)의 API를 실시간으로 호출하여 가져온다.

### 3. 사용자 통제권 (User Control)
* AI가 생성한 초안은 사용자 본인이 자유롭게 **수정** 및 **삭제**할 수 있어야 한다.
* 최종 저장되는 데이터는 오직 AI가 생성한 '텍스트 초안'과 사용자가 수정한 '최종본' 뿐이며, 원본 활동 로그는 저장되지 않는다.

---

## 3. 데이터 수집 항목 (AI 요청용)

사용자가 '회고록 생성' (기간: `startDate` ~ `endDate`)을 요청하면, 시스템은 다음 데이터를 API를 통해 실시간으로 수집하여 AI(LLM)에게 전달할 '문맥(Context)'을 구성한다.

| 수집 시스템 | 수집 데이터 | 상세 항목 | AI(LLM) 제공 목적 |
| :--- | :--- | :--- | :--- |
| **Jira** | **1. 내가 완료한 이슈** | `key`, `summary` (제목), `resolutiondate` | "내가 **무엇을 완수했는지** 요약" |
| **Jira** | **2. 내가 생성한 이슈** | `key`, `summary` (제목), `created` | "내가 **어떤 문제를 제기/발견했는지** 요약" |
| **Jira** | **3. 나의 이슈 코멘트** | `comment.body` (내가 작성한 코멘트 내용), `parent_issue.summary` | "내가 **어떤 논의에 기여하고 문제를 해결**했는지 추론" |
| **Jira** | **4. 내가 할당받은 이슈** | `key`, `summary` (제목), `status` | "내가 **현재 진행 중이거나 담당한 업무** 파악" |
| **Bitbucket** | **5. 나의 커밋 내역** | `message` (커밋 메시지), `date` | "내가 **실제로 수행한 구체적인 작업 내역** 요약" |
| **Bitbucket** | **6. (선택) 나의 PR/MR** | `title`, `description` (PR/MR 제목 및 본문) | "내가 **어떤 단위의 기능을 개발/리뷰**했는지 파악" |

---

## 4. 데이터 처리 및 LLM 요청 흐름

1.  **사용자 요청**: 사용자가 기간(예: 최근 6개월)을 설정하고 '회고록 생성' 버튼 클릭.
2.  **데이터 수집 (On-Demand)**: 서버는 사용자의 계정 연동 정보(`FR-B-1.1`)를 기반으로, 3번 항목의 데이터들을 Jira/Bitbucket API에서 실시간으로 조회.
3.  **문맥(Context) 구성**: 수집된 데이터를 AI(LLM)가 이해하기 쉬운 구조화된 텍스트로 변환.
    > **[LLM Prompt 입력 예시]**
    >
    > "당신은 IT 전문가의 업무 회고록을 작성하는 AI 비서입니다. 다음은 [2025-01-01 ~ 2025-06-30] 동안 A님의 활동 내역입니다. 이 내용을 바탕으로 항목별(예: 주요 성과, 문제 해결, 기여)로 회고록 초안을 작성해 주세요."
    >
    > **[완료한 이슈]**
    > - JIRA-123: 결제 시스템 장애 대응
    > - JIRA-145: 신규 쿠폰 기능 개발
    >
    > **[주요 커밋 메시지]**
    > - feat(JIRA-145): 쿠폰 할인 로직 추가
    > - fix(JIRA-123): PG사 타임아웃 오류 수정
    >
    > **[주요 코멘트]**
    > - (JIRA-123에서) "원인 파악 완료. A모듈의 타임아웃 설정 문제로 보이며, 30초로 상향 조정 필요합니다."
    > ... (이하 생략) ...

4.  **AI(LLM) 요청**: `FR-B-1.2` 및 `NFR-6` (기술 확장성) 요구사항에 따라, 특정 LLM(예: GPT)에 종속되지 않도록 `LlmService` 인터페이스를 통해 요청 전송.
5.  **결과 반환**: LLM이 생성한 텍스트 초안(Markdown/Text)을 사용자에게 반환.

---

## 5. 데이터 저장 및 보안 (프라이버시)

`FR-B-1.3` (프라이버시 보장)을 위한 핵심 설계입니다.

### 5.1. `Retrospective` (회고록) 테이블
* AI가 생성했거나 사용자가 수정한 **최종 텍스트만** 저장하는 테이블.

| 컬럼명 | 데이터 타입 | 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| `retrospective_id` | `BIGINT` (PK) | 회고록 고유 ID | |
| `user_id` | `BIGINT` (FK, User) | **[보안]** 회고록 소유자 ID | **접근 제어의 핵심** |
| `evaluation_period_id` | `BIGINT` (FK) | 귀속된 평가 주기 | (선택 사항) |
| `title` | `VARCHAR(255)` | 회고록 제목 (예: "2025년 상반기 회고") | |
| `content` | `TEXT` | **[Private]** 회고록 본문 | |
| `created_at` | `DATETIME` | 생성 일시 | |
| `updated_at` | `DATETIME` | 최종 수정 일시 | |

### 5.2. 보안 및 접근 제어 (API)
* `Retrospective` 테이블에 대한 모든 API(CRUD)는 **반드시 `user_id`를 기반으로 접근을 제어**해야 합니다.
* **`GET /api/v1/retrospectives`**: (내 회고록 목록 조회)
    * `SELECT * FROM Retrospective WHERE user_id = {current_user_id}`
* **`PUT /api/v1/retrospectives/{id}`**: (내 회고록 수정)
    * `UPDATE Retrospective SET content = ? WHERE retrospective_id = {id} AND user_id = {current_user_id}`
* 어떠한 경우에도 `user_id`가 일치하지 않는 타인의 데이터는 조회/수정/삭제할 수 없도록 API 및 데이터베이스 쿼리 레벨에서 차단합니다.