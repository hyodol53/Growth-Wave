# Task 3.7: 일관성 있는 익명 칭찬 기능 구현

`REQUIREMENTS.md`의 `FR-B-3.1` 요구사항에 명시된 "발신자는 '익명의 동물'로 자동 변환된다"는 기능의 세부 구현을 완료했습니다.

## 1. 문제 정의

기존 구현은 칭찬을 보낼 때마다 완전히 새로운 임의의 익명(예: "익명의 고라니")을 부여했습니다. 이는 익명성은 보장하지만, 칭찬을 받는 사람 입장에서 동일한 발신자로부터 온 칭찬인지 파악할 수 없어 피드백의 맥락을 이해하기 어려운 문제가 있었습니다.

## 2. 해결 방안: '수신자 기준' 일관성 있는 익명성

수신자에게는 익명이지만, 누가 보냈는지 식별할 수 있는 일관성을 제공하는 새로운 로직을 도입했습니다. 

- **핵심 로직:** 특정 발신자(`A`)가 특정 수신자(`B`)에게 보내는 모든 칭찬은 평가 주기 내내 동일한 익명 이름(예: '빨간 코끼리')으로 표시됩니다. 하지만 `A`가 다른 수신자(`C`)에게 칭찬할 경우, 다른 익명 이름(예: '파란 다람쥐')이 부여됩니다.

- **구현 방식:**
    1.  사용자 `A`가 `B`에게 **처음** 칭찬할 때, '색상 + 동물' 조합으로 고유한 익명 이름을 생성합니다.
    2.  생성된 이름은 칭찬 횟수 제한을 관리하는 `PraiseLimiter` 테이블의 `(sender_id, recipient_id)` 레코드에 함께 저장됩니다.
    3.  `A`가 `B`에게 **다시** 칭찬할 때는 `PraiseLimiter`에 저장된 이름을 그대로 가져와 사용합니다.

## 3. 기술적 변경 사항

- **`app/utils/anonymous_names.py` 추가:**
  - 색상(20종)과 동물(50종) 목록을 정의했습니다.
  - 특정 수신자에게 중복되지 않는 이름을 생성하는 `generate_anonymous_name` 함수를 구현했습니다.

- **데이터 모델 수정 (`app/models/praise_limiter.py`):
  - `PraiseLimiter` 모델에 생성된 익명 이름을 저장하기 위한 `anonymous_name` 컬럼을 추가했습니다.

- **CRUD 로직 리팩토링 (`app/crud/`):
  - `praise_limiter.py` CRUD 모듈을 신설하여 관련 로직을 분리했습니다.
  - `praise.py`의 칭찬 생성 로직을 전면 재작성하여, `PraiseLimiter`를 조회/업데이트하고 일관성 있는 익명 이름을 가져와 `Praise` 객체를 생성하도록 변경했습니다.
  - 칭찬 횟수 제한 초과 시 `PraiseLimitExceeded` 예외를 발생시키도록 수정했습니다.

- **API 엔드포인트 수정 (`app/api/endpoints/praises.py`):
  - 칭찬 생성 API가 새로운 CRUD 로직을 호출하고, `PraiseLimitExceeded` 예외를 `HTTP 429 Too Many Requests` 오류로 처리하도록 수정했습니다.

- **테스트 강화 (`tests/api/test_praises.py`):
  - 한 사람이 다른 사람에게 여러 번 칭찬했을 때, 익명 이름이 동일하게 유지되는지 검증하는 테스트 케이스를 추가했습니다.
  - 다른 사람이 칭찬했을 때, 익명 이름이 다르게 부여되는지도 함께 검증했습니다.

## 4. 결론

위의 변경 사항을 통해, 단순 익명성을 넘어 사용자 경험과 피드백의 가치를 높이는 '일관성 있는 익명 칭찬' 기능을 안정적으로 구현했습니다. 모든 관련 테스트가 성공적으로 통과함을 확인했습니다.